# 第0章: はじめに

## セキュリティの三要素（CIA）

```
┌─────────────────────────────────────────────────────────────┐
│                      CIA Triad                               │
│                                                             │
│            ┌─────────────────────┐                          │
│            │   Confidentiality   │                          │
│            │      (機密性)       │                          │
│            │                     │                          │
│            │  データへのアクセスを │                          │
│            │  許可された人のみに   │                          │
│            └──────────┬──────────┘                          │
│                       │                                     │
│      ┌────────────────┼────────────────┐                    │
│      │                │                │                    │
│      ▼                ▼                ▼                    │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐              │
│  │ Integrity │  │           │  │Availability│              │
│  │  (完全性) │  │           │  │  (可用性)  │              │
│  │           │  │           │  │           │              │
│  │ データの  │  │           │  │ 必要な時に │              │
│  │ 正確性を  │  │           │  │ アクセス   │              │
│  │ 保証する  │  │           │  │ できる     │              │
│  └───────────┘  └───────────┘  └───────────┘              │
└─────────────────────────────────────────────────────────────┘
```

## 防御層（Defense in Depth）

```
┌────────────────────────────────────────────────────────────┐
│                  多層防御モデル                              │
│                                                            │
│  ┌──────────────────────────────────────────────────────┐ │
│  │                    物理セキュリティ                    │ │
│  │  ┌──────────────────────────────────────────────┐   │ │
│  │  │                 ネットワーク                    │   │ │
│  │  │  ┌──────────────────────────────────────┐   │   │ │
│  │  │  │              ホスト                    │   │   │ │
│  │  │  │  ┌──────────────────────────────┐   │   │   │ │
│  │  │  │  │          アプリケーション       │   │   │   │ │
│  │  │  │  │  ┌──────────────────────┐   │   │   │   │ │
│  │  │  │  │  │        データ         │   │   │   │   │ │
│  │  │  │  │  └──────────────────────┘   │   │   │   │ │
│  │  │  │  └──────────────────────────────┘   │   │   │ │
│  │  │  └──────────────────────────────────────┘   │   │ │
│  │  └──────────────────────────────────────────────┘   │ │
│  └──────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────┘
```

## セキュリティ脅威の種類

```
┌────────────────────────────────────────────────────────────┐
│                    主要な脅威                               │
│                                                            │
│  1. インジェクション攻撃                                    │
│     • SQL インジェクション                                  │
│     • コマンドインジェクション                              │
│     • XSS (Cross-Site Scripting)                          │
│                                                            │
│  2. 認証・セッション攻撃                                    │
│     • ブルートフォース攻撃                                  │
│     • セッションハイジャック                                │
│     • CSRF (Cross-Site Request Forgery)                   │
│                                                            │
│  3. 情報漏洩                                               │
│     • 機密データの露出                                      │
│     • エラーメッセージからの情報漏洩                        │
│     • ログからの情報漏洩                                    │
│                                                            │
│  4. アクセス制御の不備                                      │
│     • 権限昇格                                             │
│     • 不正なリソースアクセス                                │
└────────────────────────────────────────────────────────────┘
```

## セキュリティの原則

### 最小権限の原則

```typescript
// ❌ 広すぎる権限
const adminRole = {
  permissions: ["*"], // 全権限
};

// ✅ 必要最小限の権限
const editorRole = {
  permissions: [
    "article:read",
    "article:create",
    "article:update",
    // article:delete は含まない
  ],
};
```

### フェイルセキュア

```typescript
// ❌ 失敗時にアクセス許可
function checkPermission(user: User, resource: string): boolean {
  try {
    return hasPermission(user, resource);
  } catch {
    return true; // 危険！
  }
}

// ✅ 失敗時はアクセス拒否
function checkPermission(user: User, resource: string): boolean {
  try {
    return hasPermission(user, resource);
  } catch {
    console.error("Permission check failed");
    return false; // 安全
  }
}
```

### 入力は信用しない

```typescript
// すべての入力をバリデーション
import { z } from "zod";

const userInputSchema = z.object({
  email: z.string().email(),
  age: z.number().int().min(0).max(150),
  name: z.string().min(1).max(100),
});

function processUserInput(input: unknown) {
  const validated = userInputSchema.parse(input);
  // validated は安全に使用可能
}
```

## 決済セキュリティの重要性

```
┌────────────────────────────────────────────────────────────┐
│                 決済機能のリスク                             │
│                                                            │
│  金銭的被害:                                                │
│  • 不正利用による直接的な損失                                │
│  • チャージバックコスト                                     │
│  • 規制違反による罰金                                       │
│                                                            │
│  信用被害:                                                  │
│  • 顧客からの信頼喪失                                       │
│  • ブランドイメージの毀損                                   │
│  • 決済サービス利用停止                                     │
│                                                            │
│  法的責任:                                                  │
│  • PCI DSS 違反                                            │
│  • 個人情報保護法違反                                       │
│  • 損害賠償請求                                             │
└────────────────────────────────────────────────────────────┘
```

## 次のステップ

次章では、OWASP Top 10 の脆弱性と対策を学びます。
