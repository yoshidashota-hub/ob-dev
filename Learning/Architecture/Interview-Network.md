# ネットワーク - 技術面接対策

## 概要

ネットワーク・プロトコルの基礎知識。HTTP、TCP/IP、DNS、WebSocket、リアルタイム通信など。

---

## 1. ブラウザで URL を叩いてから表示されるまで

### 1. DNS 解決

```
ブラウザ → DNSリゾルバ → ルートDNS → TLD → 権威DNS
キャッシュがあればそこから返る
```

### 2. TCP 接続

```
3ウェイハンドシェイク: SYN → SYN-ACK → ACK
```

### 3. TLS ハンドシェイク（HTTPS）

```
証明書検証 → 暗号化セッション確立
```

### 4. HTTP リクエスト・レスポンス

```
クライアント → ロードバランサー → Webサーバー → アプリ → DB
                          ← HTMLレスポンス ←
```

### 5. ブラウザレンダリング

```
HTML受信 → DOMツリー構築
CSS読込 → CSSOMツリー構築
DOM + CSSOM → レンダーツリー
レイアウト計算（Reflow）→ ペイント → 合成（Composite）
```

---

## 2. HTTP/1.1, 2, 3 の違い

| バージョン | 特徴                                          | HoL Blocking     |
| ---------- | --------------------------------------------- | ---------------- |
| HTTP/1.1   | Keep-Alive、1 接続 1 リクエスト               | 発生             |
| HTTP/2     | 多重化（ストリーム）、HPACK、サーバープッシュ | TCP レベルで発生 |
| HTTP/3     | QUIC（UDP）、接続確立高速化                   | 解消             |

### HTTP/2 の多重化

- 1 つの TCP 接続で複数のリクエスト/レスポンスを並行処理
- ストリーム ID で識別

### HTTP/3 の QUIC

- UDP ベースの新プロトコル
- TCP の HoL Blocking を完全解消
- 0-RTT 接続確立

---

## 3. WebSocket vs SSE

| 項目         | WebSocket        | SSE                     |
| ------------ | ---------------- | ----------------------- |
| 通信方向     | 双方向           | サーバー → クライアント |
| プロトコル   | 独自             | HTTP                    |
| 再接続       | 手動実装         | 自動                    |
| ユースケース | チャット、ゲーム | 通知、フィード更新      |

### 使い分け

- **WebSocket**: リアルタイム双方向が必要
- **SSE**: サーバープッシュだけで十分、HTTP インフラとの親和性

---

## 4. CDN

### なぜ速い？

- エッジロケーション（地理的に近いサーバー）からコンテンツ配信
- レイテンシが低い

### キャッシュ管理

- [ ] Cache-Control ヘッダー
- [ ] ETag による検証
- [ ] 手動パージ
- [ ] オリジンシールド（オリジンへのリクエスト集約）

---

## 5. TCP

### 輻輳制御

| アルゴリズム    | 特徴                             |
| --------------- | -------------------------------- |
| スロースタート  | 小さいウィンドウから指数的に増加 |
| 輻輳回避        | 閾値を超えたら線形に増加         |
| Fast Retransmit | 3 つの重複 ACK で再送            |
| CUBIC           | Linux 標準、高帯域・高遅延向け   |
| BBR             | Google 開発、帯域と RTT を推定   |

### TIME_WAIT 問題

**原因**: 短命なコネクションが多発すると溜まる（2MSL ≈ 60 秒待機）

**対策**:

- [ ] SO_REUSEADDR の設定
- [ ] コネクションプーリング
- [ ] Keep-Alive の活用
- [ ] tcp_tw_reuse の有効化

---

## 6. NAT

### 種類

| 種類 | 説明                                            |
| ---- | ----------------------------------------------- |
| SNAT | 送信元アドレス変換（プライベート → グローバル） |
| DNAT | 宛先アドレス変換（ポートフォワーディング）      |

### NAT タイプ（緩い順）

1. Full Cone
2. Restricted Cone
3. Port Restricted Cone
4. Symmetric（最も厳しい）

**P2P 通信への影響**: Symmetric NAT だと STUN が使えず、TURN が必要

---

## 7. DNS

### 再帰クエリ vs 反復クエリ

| 種類       | 動作                                      |
| ---------- | ----------------------------------------- |
| 再帰クエリ | リゾルバが最終回答まで責任を持つ          |
| 反復クエリ | リゾルバが各 DNS サーバーに順次問い合わせ |

---

## 8. gRPC vs REST

| 項目           | gRPC                         | REST             |
| -------------- | ---------------------------- | ---------------- |
| フォーマット   | Protocol Buffers（バイナリ） | JSON（テキスト） |
| 通信           | HTTP/2 多重化                | HTTP/1.1 互換    |
| 型安全         | あり                         | なし             |
| ストリーミング | 対応                         | 限定的           |
| デバッグ       | 難しい                       | 容易             |
| 適用場面       | マイクロサービス間           | 公開 API         |

---

## 9. WebRTC・リアルタイム通信

### 接続確立フロー

```
1. シグナリング（WebSocket等）でSDP交換
2. ICE候補の収集・交換
3. STUN/TURNでNAT越え
4. P2P接続確立
```

### SDP (Session Description Protocol)

- メディア情報（コーデック、解像度など）を記述

### ICE (Interactive Connectivity Establishment)

- NAT 越えのための候補収集

### STUN vs TURN

| 項目   | STUN                     | TURN           |
| ------ | ------------------------ | -------------- |
| 役割   | パブリック IP/ポート発見 | リレーサーバー |
| 通信   | P2P                      | サーバー経由   |
| コスト | 低い                     | 高い           |

### 1 対多配信アーキテクチャ

| 方式 | 特徴                 |
| ---- | -------------------- |
| SFU  | ストリームを選択転送 |
| MCU  | ストリームを合成     |

### 低遅延配信

| 方式     | 遅延 | 安定性         |
| -------- | ---- | -------------- |
| WebRTC   | 最小 | P2P 依存       |
| HLS/DASH | 高い | CDN 配信で安定 |

---

## 学習チェックリスト

### 基本

- [ ] TCP 3 ウェイハンドシェイクを説明できる
- [ ] HTTP/1.1, 2, 3 の違いを説明できる
- [ ] DNS 解決の流れを説明できる

### 応用

- [ ] WebSocket と SSE の使い分けを説明できる
- [ ] CDN のキャッシュ戦略を説明できる
- [ ] NAT 越えの仕組みを説明できる

### WebRTC

- [ ] シグナリングの流れを説明できる
- [ ] STUN/TURN の役割を説明できる

---

## 関連ノート

- [[Interview-CS-Fundamentals]]
- [[Interview-Security]]
- [[Interview-Backend-API]]
